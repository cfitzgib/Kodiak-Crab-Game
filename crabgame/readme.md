# Crab n' Click

## Summary

Crab n' Click is a Django application designed to assist the NOAA with crab oocyte area analysis. It provides an interactive session for users to click through photos of crab oocytes identify the best among those that an image analysis process has selected as being good. This data is then stored within Socrata, a government cloud storage service.

process_images.py is separate from the django application but is also included. It is designed for researchers in Kodiak Laboratory to perform crab oocyte area analysis more easily and efficiently.

## Requirements

The following versions and packages are required to properly run Crab n' Click:

1.	Python version >= 3.5
2.	Django version >= 2.0
3.	SodaPy
4.	Psycopg2

The following versions and packages are required to run the process_images.py script:

1.	Python version >= 3.5
2.	Math
3.	OpenCV (cv2)
4.	Python Image Library (PIL)
5.	Matplotlib
6.	Pylab
7.	SkImage

## Setup

Populating the system with the appropriate images is critical for Crab n' Click to be of use. 

To generate images, the process_images.py script should be used LOCALLY on .tif images to resize and label them. This folder should be the directory where images for crabs are stored. For example, this command might be run from the directory:
`python process_images.py images`
	
The images directory specified in the command must be configured a specific way. It expects a directory structure within the specified folder with crab sample numbers as the folder name with individual images inside of it. An example directory is displayed below:

	images
		0
			untitled000.tif
			untitled001.tif
		1
			untitled000.tif
		2
			untitled000.tif
		3
			untitled000.tif
		4

Running this command will take any .tif file and create 2 new files, a resized version of the original and a labeled version that has been filtered. These can then be used to load into the Crab n' Click application. Do NOT change the file names after the processing has been done.

With the images resized and labeled, first run the migrations:

`python manage.py migrate`

Then enter the Django shell:

`python manage.py shell`

Next, import the models:

`from crabgame.models import Crab, Image, Oocyte`

Finally, call the Crab class method create_image_instances with a path to a directory:

`Crab.create_image_instances(PATH)`

This path should be a directory that has a structure similar to the example below:

	images
		0
			untitled000_resized.png
			untitled000_labeled.png
			untitled001_resized.png
			untitled001_labeled.png
		1
			untitled000_resized.png
			untitled000_labeled.png
		2
			untitled000_resized.png
			untitled000_labeled.png
		3
			untitled000_resized.png
			untitled000_labeled.png
		4


These images should have been generated by the process_images.py script which the user should also have access to.

## Usage

To run the server locally, use the standard command:

`python manage.py runserver`

The larger Django application can be easily deployed using the Pipfile which specifies dependencies on services such as Heroku

